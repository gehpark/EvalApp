<!DOCTYPE html>
<html>
  <head>
    <title> Evaluation Application </title>

    <link href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/shift.css" rel="stylesheet">
    
    <link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
    <link rel="stylesheet" href="public/css/style.css">

    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var socket = io();
    </script>
    <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
    <script src="network.js"></script>

    <script>
  // This is a very simple code example. See chat.html for a more involved
  // example.

  $(document).ready(function() {

    for (client c in behavior.clients) { 
      // create a Peer 
    behavior.clients[c].peer = 
      new Peer({
        key: 'x7fwx2kavpy6tj4i',
        //Set highest debug level (log everything!).
        debug: 3,
        // Set a logging function:
        logFunction: function() {
          var copy = Array.prototype.slice.call(arguments).join(' ');
          $('.log').append(copy + '<br>');
        }
      });
    behavior.clients[c].connectedPeers = {};

    // Show this peer's ID.
    peer.on('open', function(id){
      $('#pid').text(id);
    });

    // Await connections from others
    peer.on('connection', connect);
    }

    // not sure if it should all go in the for loop...
    // stopped at line 39 of: 
    // https://github.com/peers/peerjs/blob/master/examples/chat.html
    // stop line here::: 

    // no idea what the hell is going on over here. 
    // how will i get this to connect with the other stuffffff i doo not knowest. 
    
    // Handle a connection object.
    function connect(c) {
      // Handle a chat connection.
      if (c.label === 'chat') {
        var chatbox = $('<div></div>').addClass('connection').addClass('active').attr('id', c.peer);
        var header = $('<h1></h1>').html('Chat with <strong>' + c.peer + '</strong>');
        var messages = $('<div><em>Peer connected.</em></div>').addClass('messages');
        chatbox.append(header);
        chatbox.append(messages);
     
        // Select connection handler.
        chatbox.on('click', function() {
          if ($(this).attr('class').indexOf('active') === -1) {
            $(this).addClass('active');
          } else {
            $(this).removeClass('active');
          }
        });
        $('.filler').hide();
        $('#connections').append(chatbox);

        c.on('data', function(data) {
          messages.append('<div><span class="peer">' + c.peer + '</span>: ' + data +
            '</div>');
            });
            c.on('close', function() {
              alert(c.peer + ' has left the chat.');
              chatbox.remove();
              if ($('.connection').length === 0) {
                $('.filler').show();
              }
              delete connectedPeers[c.peer];
            });
      } else if (c.label === 'file') {
        c.on('data', function(data) {
          // If we're getting a file, create a URL for it.
          if (data.constructor === ArrayBuffer) {
            var dataView = new Uint8Array(data);
            var dataBlob = new Blob([dataView]);
            var url = window.URL.createObjectURL(dataBlob);
            $('#' + c.peer).find('.messages').append('<div><span class="file">' +
                c.peer + ' has sent you a <a target="_blank" href="' + url + '">file</a>.</span></div>');
          }
        });
      }
      connectedPeers[c.peer] = 1;
    }


  });


</script>

  </head>

  <body>
    <div class="nav">
      <div class="container">
        <ul class = "pull-left">
          <li><a href="/home.html">Mitsubishi Home</a></li>
          <li><a href="/about.html">About</a></li>
        </ul>
        <ul class = "pull-right">
          <li><a href="/index.html">Simulation</a></li>
          <li><a href="/contact.html">Contact</a></li>
          <li><a href="/help.html">Help</a></li>
        </ul>
      </div>
    </div>

    <div class="jumbotron">
      <div class="container">
        <h1>Interactive Web App</h1>
        <p>Run simulations to test the effectiveness of DHTs</p>
        <button onclick=socket.emit('start')>Click to start running! </button>
        <button onclick=socket.emit('stop')>Stop </button>
      </div>
    </div> 
    
  </body>
</html>
